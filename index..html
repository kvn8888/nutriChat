<!DOCTYPE html>
<html>
<head>
  <title>My App</title>
  <link href="/nutriChat/src/index.css" rel="stylesheet">
  <script>
    function handleButtonPress() {
      var apiKey = document.getElementById('apiKey').value;
      var message = document.getElementById('message').value;

      var options = {
        method: 'POST',
        headers: {
          accept: 'application/json',
          'content-type': 'application/json',
          authorization: 'Bearer ' + apiKey
        },
        body: JSON.stringify({
          model: 'mixtral-8x7b-instruct',
          messages: [
            {
              role: 'system',
              content: 'Only respond in JSON. The JSON will have attributes of Calories, Carbs, Fats, Protein ONLY. All four of these attributes. NEVER OUTPUT ANYTHING OUTSIDE THE THREE ATTRIBUTES INSIDE THE JSON. **Important**: Once you have finished outputting JSON, end the response immediately, NEVER PUT UNITS!!!!!!!!!!!!!'
            },
            {role: 'user', content: message}
          ]
        })
      };

      fetch('/api/chat/completions', options)
        .then(response => {
          console.log(response); // Log the raw response
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          console.log(data);
          document.getElementById('response').textContent = JSON.stringify(data);
        })
        .catch(err => console.error(err));
        document.getElementById('apiKey').style.display = 'none';
        document.getElementById('submitButton').style.display = 'none';
    }

    function placeHolder() {
  document.getElementById("chatbox").placeholder = "";
}
  </script>
</head>
<body>
  <div id='bodybox'>
    <h1>NutriChat</h1>
    <div id='chatborder'>
      <p id="chatlog7" class="chatlog">&nbsp;</p>
      <p id="chatlog6" class="chatlog">&nbsp;</p>
      <p id="chatlog5" class="chatlog">&nbsp;</p>
      <p id="chatlog4" class="chatlog">&nbsp;</p>
      <p id="chatlog3" class="chatlog">&nbsp;</p>
      <p id="chatlog2" class="chatlog">&nbsp;</p>
      <p id="response" class="chatlog">&nbsp;</p>
      <input id='apiKey' name="apiChat" type='text' placeholder='Enter API Key'/>
      <input type="text" name="chat" id="message" placeholder="Hi there! Type here to talk to me." onfocus="placeHolder()">
      <button id="sendbtn" onclick='handleButtonPress()'>Send</button>
    </div>
</body>
</html>